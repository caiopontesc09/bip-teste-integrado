<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Benefícios</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .section { margin-bottom: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        h1 { color: #333; text-align: center; }
        h2 { color: #555; border-bottom: 2px solid #007bff; padding-bottom: 5px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #f8f9fa; font-weight: bold; }
        .btn { background-color: #007bff; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        .btn:hover { background-color: #0056b3; }
        .btn-danger { background-color: #dc3545; }
        .btn-danger:hover { background-color: #c82333; }
        form { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
        input, select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; min-width: 150px; }
        .message { padding: 10px; margin: 10px 0; border-radius: 4px; background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .message.error { background-color: #f8d7da; color: #721c24; border-color: #f5c6cb; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Sistema de Benefícios</h1>
        
        <div class="section">
            <h2>Lista de Benefícios</h2>
            <button onclick="loadBeneficios()" class="btn">Atualizar</button>
            
            <table id="beneficiosTable" class="hidden">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>Descrição</th>
                        <th>Valor</th>
                        <th>Ativo</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="beneficiosBody">
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>Criar Benefício</h2>
            <form onsubmit="createBeneficio(event)">
                <input id="nome" placeholder="Nome" required>
                <input id="descricao" placeholder="Descrição">
                <input id="valor" type="number" step="0.01" placeholder="Valor" required>
                <button type="submit" class="btn">Criar</button>
            </form>
        </div>

        <div class="section">
            <h2>Transferência</h2>
            <form onsubmit="transfer(event)">
                <select id="fromId" required>
                    <option value="">Selecione origem</option>
                </select>
                <select id="toId" required>
                    <option value="">Selecione destino</option>
                </select>
                <input id="amount" type="number" step="0.01" placeholder="Valor" required>
                <button type="submit" class="btn">Transferir</button>
            </form>
        </div>

        <div id="message" class="message hidden"></div>
    </div>

    <script>
        const apiUrl = 'http://localhost:8080/api/v1/beneficios';
        let beneficios = [];

        async function loadBeneficios() {
            try {
                const response = await fetch(apiUrl);
                beneficios = await response.json();
                renderBeneficios();
                updateSelects();
                showMessage('Benefícios carregados com sucesso', false);
            } catch (error) {
                showMessage('Erro ao carregar benefícios: ' + error.message, true);
            }
        }

        function renderBeneficios() {
            const tbody = document.getElementById('beneficiosBody');
            const table = document.getElementById('beneficiosTable');
            
            if (beneficios.length > 0) {
                table.classList.remove('hidden');
                tbody.innerHTML = beneficios.map(b => `
                    <tr>
                        <td>${b.id}</td>
                        <td>${b.nome}</td>
                        <td>${b.descricao}</td>
                        <td>R$ ${b.valor.toFixed(2)}</td>
                        <td>${b.ativo ? 'Sim' : 'Não'}</td>
                        <td>
                            <button onclick="deleteBeneficio(${b.id})" class="btn btn-danger">Excluir</button>
                        </td>
                    </tr>
                `).join('');
            } else {
                table.classList.add('hidden');
            }
        }

        function updateSelects() {
            const fromSelect = document.getElementById('fromId');
            const toSelect = document.getElementById('toId');
            
            const options = beneficios.map(b => 
                `<option value="${b.id}">${b.nome} (R$ ${b.valor.toFixed(2)})</option>`
            ).join('');
            
            fromSelect.innerHTML = '<option value="">Selecione origem</option>' + options;
            toSelect.innerHTML = '<option value="">Selecione destino</option>' + options;
        }

        async function createBeneficio(event) {
            event.preventDefault();
            
            const beneficio = {
                nome: document.getElementById('nome').value,
                descricao: document.getElementById('descricao').value,
                valor: parseFloat(document.getElementById('valor').value),
                ativo: true
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(beneficio)
                });
                
                if (response.ok) {
                    document.getElementById('nome').value = '';
                    document.getElementById('descricao').value = '';
                    document.getElementById('valor').value = '';
                    loadBeneficios();
                    showMessage('Benefício criado com sucesso', false);
                }
            } catch (error) {
                showMessage('Erro ao criar benefício: ' + error.message, true);
            }
        }

        async function deleteBeneficio(id) {
            try {
                const response = await fetch(`${apiUrl}/${id}`, { method: 'DELETE' });
                if (response.ok) {
                    loadBeneficios();
                    showMessage('Benefício excluído com sucesso', false);
                }
            } catch (error) {
                showMessage('Erro ao excluir benefício: ' + error.message, true);
            }
        }

        async function transfer(event) {
            event.preventDefault();
            
            const transferData = {
                fromId: parseInt(document.getElementById('fromId').value),
                toId: parseInt(document.getElementById('toId').value),
                amount: parseFloat(document.getElementById('amount').value)
            };

            try {
                const response = await fetch(`${apiUrl}/transfer`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(transferData)
                });
                
                if (response.ok) {
                    const message = await response.text();
                    document.getElementById('fromId').value = '';
                    document.getElementById('toId').value = '';
                    document.getElementById('amount').value = '';
                    loadBeneficios();
                    showMessage(message, false);
                } else {
                    const error = await response.text();
                    showMessage('Erro na transferência: ' + error, true);
                }
            } catch (error) {
                showMessage('Erro na transferência: ' + error.message, true);
            }
        }

        function showMessage(message, isError) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = message;
            messageDiv.className = isError ? 'message error' : 'message';
            messageDiv.classList.remove('hidden');
            
            setTimeout(() => {
                messageDiv.classList.add('hidden');
            }, 5000);
        }
        loadBeneficios();
    </script>
</body>
</html>